<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AR Test Minimal</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
body { margin:0; overflow:hidden; background:#000; }
#tap-overlay {
    position:absolute; top:0; left:0; width:100%; height:100%;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    background:rgba(0,0,0,0.85); color:white; z-index:10;
}
#btn-start { padding:15px 40px; font-size:20px; background:#bf55ec; border:none; border-radius:50px; color:white; }
</style>
</head>
<body>

<div id="tap-overlay">
    <h2>AR Test</h2>
    <button id="btn-start">開始</button>
</div>

<script>
let scene, camera, renderer, portal;

async function init() {

    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 1.6, 0);

    renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // カメラ映像
    try {
        const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
        const video = document.createElement('video');
        video.srcObject = stream;
        video.setAttribute('playsinline','');
        await video.play();
        scene.background = new THREE.VideoTexture(video);
    } catch(e) {
        alert("カメラが取得できません: "+e);
    }

    // 最初のポータルだけ
    const loader = new THREE.TextureLoader();
    const tex = loader.load('./day_1.jpg', ()=>{
        renderer.render(scene,camera); // テクスチャ読み込み後描画
    });
    const pGeo = new THREE.CylinderGeometry(5,5,8,32,1,true,Math.PI*0.65,Math.PI*0.7);
    const pMat = new THREE.MeshBasicMaterial({map:tex, side:THREE.BackSide, transparent:true, opacity:1});
    portal = new THREE.Mesh(pGeo,pMat);
    portal.position.set(0,0,-4.5);
    scene.add(portal);

    animate();
}

function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene,camera);
}

document.getElementById('btn-start').onclick = ()=>{
    init();
    document.getElementById('tap-overlay').style.display='none';
};
</script>
</body>
</html>
