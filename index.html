// --- animate関数内の修正ポイント ---

function animate() {
    requestAnimationFrame(animate);

    if (doorGroup && doorGroup.userData.isOpen) {
        // 1. 扉を「少しずつ」ゆっくり開く（0.04 -> 0.015 に変更）
        doorGroup.userData.left.position.x = THREE.MathUtils.lerp(doorGroup.userData.left.position.x, -2.5, 0.015);
        doorGroup.userData.right.position.x = THREE.MathUtils.lerp(doorGroup.userData.right.position.x, 2.5, 0.015);
        
        // 扉に回転も加えて、より「開いている感」を出す
        doorGroup.userData.left.rotation.y = THREE.MathUtils.lerp(doorGroup.userData.left.rotation.y, Math.PI / 2.5, 0.01);
        doorGroup.userData.right.rotation.y = THREE.MathUtils.lerp(doorGroup.userData.right.rotation.y, -Math.PI / 2.5, 0.01);

        // 2. 扉が開くスピードに合わせて、景色をフェードイン
        // 扉がある程度開いてから景色を100%にする
        const currentX = Math.abs(doorGroup.userData.left.position.x);
        const progress = THREE.MathUtils.clamp((currentX - 0.5) / 1.5, 0, 1);
        sphere.material.opacity = progress;
    }

    if (isImmersed) {
        camera.position.set(0, 1.5, -5);
    } else {
        camera.position.set(0, 1.6, 0);
    }
    renderer.render(scene, camera);
}
